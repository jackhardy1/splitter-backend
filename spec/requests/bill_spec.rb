describe 'bills API' do

  let(:json) { JSON.parse(response.body) }

  describe '#index' do
    it 'sends a list of bills' do
      create_list :bill, 10
      get bills_path
      expect(response).to be_success
      expect(json.length).to eq 10
    end
  end

  describe '#create' do
    it 'creates a bill' do
      post bills_path, { event: 'party' }
      expect(response).to be_success
      expect(Bill.count).to eq 1
    end

    it 'adds an image to bill' do
      image = "data:image/jpeg;base64,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"
      post bills_path, { image: image }
      expect(response).to be_success
      expect(Bill.last.image_content_type).to eq 'image/jpeg'
    end
  end

  describe '#show' do
    it 'sends an individual bill' do
      create_list :bill, 10
      my_bill = Bill.create(event: 'dinner')
      get bill_path(my_bill)
      expect(response).to be_success
      expect(json).to include_json(event: 'dinner')
      expect(json).not_to include_json(event: 'party')
    end
  end



end
